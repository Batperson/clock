20/10/2019
There is a high-frequency whine from the audio. This changes in frequency with the length of the
audio sample buffer, so there is likely a glitch when populating the buffer.

There is an audible glitch every 1 seconds, it is caused by the RTC interrupt.

Currently using 150 ohm / 0.1 uF RC low pass filter. HF PWM is attenuated to around 0.1V.

29/10/2019
Implemented button firmware. IDR value is always 1 for all buttons.

02/11/2019
Buttons are working correctly now. Needed to add pull-down resistors even though I specified internal pulldown resistors.

03/11/2019
Implemented a beep routine for button press. This is working but a hard fault occurs if the beep is triggered
by a long button press while a song is playing.

12/11/2019
160 * 128 bare TFT with 14-pin flex connector. Maybe glue directly to outside of enclosure?
Pinout:
1  NC
2  VSS		connect to GND
3  LED-		connect to GND
4  LED+		connect to 3V3 (LED backlight. Resistor needed?)
5  VSS		connect to GND
6  /RESET	reset active low
7  A0		data/command for 4-wire SPI
8  SDA		serial data, MOSI
9  SCK		serial clock
10 VDDA		connect to 3V3 (analog supply)
11 VDDIC	connect to 3V3 (VDDIO? digital supply)
12 /CS		chip select active low
13 VSS		connect to GND
14 NC

13/11/2019
Free shipping to Dec 31 for Element14 with I'MINVITEDFORFREESHIPPING in special instructions/other in delivery options. Order amplifier ICs.
Bomb disarming puzzle in suitcase: https://imgur.com/a/8nmzieA

17/11/2019
Clock set functionality working. Counter does not update immediately.
Next tasks:
* Implement a menu timeout to play an alarm song if the menu option is selected for 1 sec
* Implement a centre-align text render

Audio output has an unpleasant whine. The whine is reduced if LoadSoundBuffer returns early, and goes away entirely if the sound buffer
contains only zeroes. It shows on the oscilloscope as a square wave.
The whine is present on the VCC line so most likely digital noise.
The click which occurs every second when the screen refreshes is also present asa voltage drop on VCC.
The whine is most likely caused by voltage fluctuations which occur as interrupts change the demand for current.
It is mitigated by removing the __WFI() line (i.e. disabling sleep until interrupt) and by placing a 220uF cap
across VCC / GND.

18/11/2019
Now possible to preview an alarm ring by highlighting it in the alarm menu, it will play after 1.5 secs.

26/11/2019
Revised the button system.
Now an issue where the same button events repeat, if the button handlers are changed (e.g. when displaying a menu).
Fixed the button issue.
Seems to be a memory corruption problem, where song state is being overwritten.

30/11/2019
There was no memory corruption, but because I had not declared some variables static but given them the same name across different code units, the linker
made them share the same memory location. Problem is fixed now.

21/12/2019
Most functionality now working. Time and date can be set. Alarm can be set. User must enter an unlock sequence to stop the alarm, this will be an option they can select.
Next tasks to complete:
* The FillMargin flag for DrawText currently assumes text is centred vertically & horizontally
* Special Day messages need to be implemented
* About screen needs to be implemented
* Too much voltage drop causing screen to go dark, and blinking when rendering
* Need to support save/restore of settings in backup domain

23/12/2019
Save/restore settings implemented.
A hard fault is occurring when doing sample playback of alarm rings in the menu. 
Special Days functionality appears to be activating at incorrect times and showing garbage.

24/12/2019
Special Day messages now appearing. Some screen garbage and incorrect colours are likely the result of re-entrancy between the render callback which fires every second
and the special day banner callback which fires every 120ms.

27/12/2019
Re-entrancy issue fixed. Next task is to fix the hard fault when doing sample playback of alarm rings.

03/01/2019
Fully implemented FillMargin behaviour

08/01/2019
Implemented alarm, snooze and no-alarm icons.
Hard fault during sample playback fixed. 
Sometimes, sample playback initiates twice in succession. Sample playback does not start when first showing
the alarm ring menu.

11/01/2019
Fixed the double-playback of alarm rings when previewing in the menu.
Added new ring: Baby Shark.

19/01/2019
Added a few new songs, for use as easter eggs.
Implemented an audio amplifier + speaker, using the TPA2005D1 audio amplifier IC from Texas Instruments. Amplifier shutdown now controlled from pin A2. Unfortunately this creates pop
so it's not possible to switch the amp on and off before playing sounds.
Note intervals now 16 bits long for tied semibreves.
New clipped sine voice, sounds better than boring pure sine tone.